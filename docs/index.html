<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Parola – Italienisch Vokabeltrainer</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#84AB8A">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Ubuntu:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --clr-sage: #84AB8A;
        --clr-mint: #EBFFF5;
        --clr-teal: #83C9C9;
        --clr-ivory: #FFFFF2;
        --clr-ink: #222222;
      }
      html,body {height:100%}
      body { margin:0; background: var(--clr-ivory); color: var(--clr-ink); font: 16px/1.45 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      .container { max-width: 1000px; margin: 0 auto; padding: 16px; }
      .btn { border:1px solid #0000; background:#fff; padding:10px 18px; border-radius:9999px; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.08); font-family:'Ubuntu','Roboto',system-ui,-apple-system; }
      .btn.primary { background: var(--clr-sage); color: white; border-color: var(--clr-sage);}
      .btn.ghost { background: white; border-color: #ddd; }
      .chip { display:inline-block; padding:4px 12px; border-radius:9999px; background:var(--clr-mint); border:1px solid #d6f5ea; font-family:'Ubuntu','Roboto'; }
      .card { background:white; border:1px solid #eaeaea; border-radius:20px; box-shadow:0 2px 8px rgba(0,0,0,.04); padding:24px; }
      header { position:sticky; top:0; background:rgba(255,255,255,.8); backdrop-filter: blur(8px); border-bottom:1px solid #eee; }
      table { width:100%; border-collapse: collapse; }
      th, td { padding:10px; border-top:1px solid #eee; text-align:left }
      .tabs button.active { background: var(--clr-ink); color:white; border-color: var(--clr-ink);}
      .muted { color:#6b7280 }
      .grid { display:grid; gap:16px }
      .grid-2 { grid-template-columns: repeat(2, minmax(0,1fr)) }
      @media (max-width: 680px) { .grid-2 { grid-template-columns: 1fr } }
      .link { color: var(--clr-sage); text-decoration: none; border-bottom: 1px dashed currentColor }
      .input, select, textarea { padding:10px 12px; border-radius:14px; border:1px solid #ddd; width:100%; font-family:'Roboto',system-ui; }
      h1, h2, h3 { font-family:'Ubuntu','Roboto',system-ui,-apple-system; }
      .speaker { margin-left:8px; }
    
/* --- Einheitliche Buttons Parola --- */
.btn,
button,
input[type="submit"],
input[type="button"] {
    border-radius: 9999px !important;
    font-family: 'Ubuntu', sans-serif !important;
    font-weight: 700 !important;
    background-color: #83C9C9 !important; /* Farbpalette */
    color: #FFFFFF !important;
    padding: 8px 16px !important;
    border: none !important;
    cursor: pointer !important;
}
.btn:hover,
button:hover,
input[type="submit"]:hover,
input[type="button"]:hover {
    opacity: 0.9;
}

    
/* --- Einheitliche Form-Elemente Parola --- */
input[type="text"],
input[type="number"],
input[type="password"],
input[type="email"],
select,
textarea {
    border-radius: 9999px !important;
    font-family: 'Roboto', sans-serif !important;
    padding: 8px 14px !important;
    border: 1px solid #ccc !important;
    outline: none !important;
}
input[type="text"]:focus,
input[type="number"]:focus,
input[type="password"]:focus,
input[type="email"]:focus,
select:focus,
textarea:focus {
    border-color: #83C9C9 !important;
    box-shadow: 0 0 4px rgba(131, 201, 201, 0.6) !important;
}

    
/* --- Parola UI polish v4 --- */
.chip {
  background: var(--clr-mint) !important;
  color: var(--clr-ink) !important;
  border: 1px solid rgba(131,201,201,0.6) !important; /* teal border */
  font-weight: 700 !important;
}

select.input {
  padding-right: 34px !important;
  border-color: rgba(131,201,201,0.8) !important;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%2383C9C9' d='M5.5 7l4.5 6 4.5-6z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px 16px;
  appearance: none; -webkit-appearance: none; -moz-appearance: none;
}

/* Prominent speaker button */
.speaker-btn {
  background: var(--clr-ink) !important;
  color: #fff !important;
  width: 40px; height: 40px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 9999px !important;
  border: none !important;
  margin-left: 8px;
}
.speaker-btn img { width: 18px; height: 18px; filter: invert(1) brightness(2); }

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* --- Speaker button v5 (bigger + white icon) --- */
.speaker-btn {
  background: var(--clr-sage) !important; /* green */
  color: #fff !important;
  width: 56px; height: 56px;            /* bigger desktop */
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 9999px !important;
  border: none !important;
  margin: 10px auto 0;                  /* center under word */
}
.speaker-btn img { width: 24px; height: 24px; filter: brightness(0) invert(1); }
@media (max-width: 640px) {
  .speaker-btn { width: 48px; height: 48px; }
  .speaker-btn img { width: 22px; height: 22px; }
}

    
/* --- Speaker button v6 (mask-based icon) --- */
.speaker-btn {
  background: var(--clr-sage) !important;
  color: #fff !important;
  width: 60px; height: 60px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 9999px !important;
  border: none !important;
  margin: 12px auto 0;
}
.speaker-btn .icon-speaker {
  display: block;
  width: 28px; height: 28px;
  background-color: #ffffff;
  -webkit-mask: url('assets/Hear-Icon.svg') center / contain no-repeat;
  mask: url('assets/Hear-Icon.svg') center / contain no-repeat;
}
@media (max-width: 640px) {
  .speaker-btn { width: 52px; height: 52px; }
  .speaker-btn .icon-speaker { width: 24px; height: 24px; }
}

    
/* --- Speaker icon v7 (icon only, no background) --- */
.speaker-icon {
  background: transparent !important;
  border: none !important;
  padding: 0 !important;
  margin: 12px auto 0 !important;
  display: inline-flex; align-items: center; justify-content: center;
  cursor: pointer;
  color: #222222; /* icon color via currentColor */
}
.speaker-icon .icon-audio { display:block; }
.speaker-icon:active { transform: scale(0.98); }
@media (max-width: 640px) {
  .speaker-icon svg { width: 32px; height: 32px; }
}

    </style>
    <script defer src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script defer src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script defer src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <header>
      <div class="container" style="display:flex; align-items:center; gap:12px; padding:12px 16px;">
        <div style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--clr-sage),var(--clr-teal));display:grid;place-items:center;color:#fff;font-weight:700;font-family:'Ubuntu'">P</div>
        <h1 style="margin:0;font-size:20px;">Parola – Italienisch Vokabeltrainer</h1>
        <div style="margin-left:auto" id="due-counter" class="muted"></div>
      </div>
    </header>
    <main class="container">
      <div id="root"></div>
    </main>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;
      const LS_KEY = "parola:v1";
      const DATE_FMT = new Intl.DateTimeFormat(undefined, { dateStyle: "medium", timeStyle: "short" });
      const now = () => Date.now();
      const minutes = (n) => n * 60 * 1000;
      const days = (n) => n * 24 * 60 * 60 * 1000;
      const INTERVALS = [ minutes(10), days(1), days(3), days(7), days(16) ];
      const uid = () => (crypto.randomUUID?.() || Math.random().toString(36).slice(2));
      const norm = (s) => (s || "").toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, "");
      const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
      const clamp = (n,a,b)=>Math.min(Math.max(n,a),b);
      function loadState() { try { return JSON.parse(localStorage.getItem(LS_KEY)||"null") } catch { return null } }
      function saveState(s) { localStorage.setItem(LS_KEY, JSON.stringify(s)) }
      function scheduleNext(card, result) {
        const idx = clamp(card.intervalIndex ?? 0, 0, INTERVALS.length-1);
        let nextIdx = idx; let streak = card.streak ?? 0;
        if (result === "good") { nextIdx = clamp(idx+1,0,INTERVALS.length-1); streak += 1; }
        else { nextIdx = 0; streak = 0; }
        return { ...card, intervalIndex: nextIdx, streak, dueAt: now() + INTERVALS[nextIdx] };
      }
      function speak(text, lang="it-IT") { if (!('speechSynthesis' in window)) return; const u=new SpeechSynthesisUtterance(text); u.lang=lang; speechSynthesis.speak(u); }

      function Tabs({ tab, setTab }) {
        const tabs = [["learn","Lernen"],["list","Vokabeln"],["add","Hinzufügen"],["settings","Einstellungen"]];
        return (<div className="tabs" style={{display:'flex', gap:8, margin:'12px 0 16px'}}>{tabs.map(([id,label]) => (<button key={id} className={{"btn":true,"active":tab===id}} onClick={()=>setTab(id)}>{label}</button>))}</div>);
      }

      function LearnView({ items, setItems }) {
        const [mode, setMode] = useState("flashcards");
        const [direction, setDirection] = useState("it-de");
        const [idx, setIdx] = useState(0);
        const [reveal, setReveal] = useState(false);
        const due = useMemo(() => items.filter(i=>!i.suspended && (i.dueAt ?? 0) <= now()), [items]);
        const current = due[Math.min(idx, Math.max(0,due.length-1))];
        useEffect(() => { const el=document.getElementById('due-counter'); if(el) el.textContent = due.length ? ('Fällig: ' + due.length) : 'Nichts fällig'; }, [due.length]);
        if (!current) return <div className="card"><b>🎉 Nichts fällig!</b><div className="muted">Füge neue Karten hinzu oder komme später wieder.</div></div>;
        const q = direction === "it-de" ? current.it : current.de;
        const a = direction === "it-de" ? current.de : current.it;
        function mark(res) { setItems(prev => prev.map(it => it.id===current.id ? scheduleNext(it, res) : it)); setReveal(false); setIdx(i=>i+1); }
        return (<div className="grid">
          <div className="card">
            <div style={{display:'flex', gap:8, alignItems:'center', justifyContent:'space-between'}}>
              <div style={{display:'flex', gap:8, alignItems:'center'}}>
                <span className="chip">Modus</span>
                <select value={mode} onChange={e=>setMode(e.target.value)} className="input" style={{width:'auto'}}>
                  <option value="flashcards">Flashcards</option>
                  <option value="mc">Multiple Choice</option>
                  <option value="typing">Tippen</option>
                </select>
              </div>
              <div style={{display:'flex', gap:8, alignItems:'center'}}>
                <span className="chip">Richtung</span>
                <select value={direction} onChange={e=>setDirection(e.target.value)} className="input" style={{width:'auto'}}>
                  <option value="it-de">Italienisch → Deutsch</option>
                  <option value="de-it">Deutsch → Italienisch</option>
                </select>
              </div>
            </div>
          </div>
          {mode === "flashcards" && (
            <div className="card" style={{textAlign:'center'}}>
              <div className="muted" style={{marginBottom:8}}>{direction === 'it-de' ? 'Frage (IT)' : 'Frage (DE)'} – Intervall: {formatInterval(INTERVALS[current.intervalIndex ?? 0])}</div>
              <div style={{fontSize:32, fontWeight:700,fontFamily:'Ubuntu'}}>{q}</div>
              <button className="speaker-icon" onClick={()=>speak(direction==='it-de' ? current.it : current.de, direction==='it-de' ? 'it-IT' : 'de-DE')}><span class="icon-speaker" aria-hidden="true" alt="Vorlesen" /><span class="sr-only">Vorlesen</span></button>
              {reveal && <div style={{marginTop:10, fontSize:22}}><b>Antwort:</b> {a}</div>}
              <div style={{marginTop:14}}><button className="speaker-icon" onClick={()=>setReveal(r=>!r)}>{reveal ? "Vorderseite" : "Auflösung zeigen"}</button></div>
              <div style={{display:'flex', gap:8, marginTop:16}}>
                <button className="speaker-icon" onClick={()=>mark('again')}>Wiederholen</button>
                <button className="btn primary" onClick={()=>mark('good')}>Gewusst</button>
              </div>
            </div>
          )}
          {mode === "mc" && <MultipleChoice current={current} direction={direction} a={a} q={q} items={items} onResult={(res)=>mark(res)} /> }
          {mode === "typing" && <Typing current={current} direction={direction} a={a} q={q} onResult={(res)=>mark(res)} /> }
        </div>);
      }

      function MultipleChoice({ current, q, a, items, direction, onResult }) {
        const { useState, useMemo } = React;
        const options = useMemo(() => { const pool = shuffle(items.filter(i=>i.id!==current.id)).slice(0,3).map(i => direction==='it-de' ? i.de : i.it); return shuffle([a, ...pool]); }, [current.id, items, a, direction]);
        const [done, setDone] = useState(false);
        function pick(opt) { if (done) return; setDone(true); onResult(norm(opt)===norm(a) ? 'good' : 'again'); }
        return (<div className="card" style={{textAlign:'center'}}>
          <div className="muted" style={{marginBottom:8}}>Multiple Choice – Frage</div>
          <div style={{fontSize:32,fontWeight:700,fontFamily:'Ubuntu'}}>{q}</div>
          <div style={{display:'grid', gap:8, marginTop:16}}>{options.map(opt => (<button key={opt} className="speaker-icon" onClick={()=>pick(opt)}>{opt}</button>))}</div>
        </div>);
      }

      function Typing({ q, a, onResult, direction, current }) {
        const { useState } = React;
        const [val, setVal] = useState(""); const [feedback, setFeedback] = useState(null);
        function submit(e) { e.preventDefault(); const ok = norm(val) === norm(a); setFeedback(ok ? "Richtig!" : ("Gesucht: " + a)); onResult(ok ? 'good' : 'again'); }
        return (<form className="card" onSubmit={submit} style={{textAlign:'center'}}>
          <div className="muted" style={{marginBottom:8}}>Tippe die Übersetzung</div>
          <div style={{fontSize:32,fontWeight:700,fontFamily:'Ubuntu'}}>{q}</div>
          <div style={{marginTop:12}}><input className="input" autoFocus value={val} onChange={e=>setVal(e.target.value)} placeholder="Antwort eingeben..." /></div>
          <div style={{display:'flex', gap:8, justifyContent:'center', marginTop:12}}>
            <button className="btn primary" type="submit">Prüfen</button>
            <button className="speaker-icon" type="button" onClick={()=>speak(direction==='it-de' ? current.it : current.de, direction==='it-de' ? 'it-IT' : 'de-DE')}>🔊 Vorlesen</button>
          </div>
          {feedback && <div style={{marginTop:12}} className="chip">{feedback}</div>}
        </form>);
      }

      function AddView({ onAdd }) {
        const { useState } = React;
        const [it,setIt] = useState(""); const [de,setDe] = useState(""); const [notes,setNotes]=useState("");
        function submit(e) { e.preventDefault(); if (!it.trim() || !de.trim()) return; onAdd({ id: uid(), it: it.trim(), de: de.trim(), notes: notes.trim() || undefined, createdAt: now(), dueAt: now(), intervalIndex:0, streak:0, suspended:false }); setIt(""); setDe(""); setNotes(""); }
        return (<form onSubmit={submit} className="card">
          <div className="grid grid-2">
            <label>Italienisch<input className="input" value={it} onChange={e=>setIt(e.target.value)} placeholder="ragazzo"/></label>
            <label>Deutsch<input className="input" value={de} onChange={e=>setDe(e.target.value)} placeholder="Junge"/></label>
          </div>
          <label style={{display:'block', marginTop:10}}>Notizen (optional)<input className="input" value={notes} onChange={e=>setNotes(e.target.value)} placeholder="Plural: ragazzi"/></label>
          <div style={{marginTop:12, display:'flex', gap:8}}>
            <button className="btn primary" type="submit">Hinzufügen</button>
            <button className="speaker-icon" type="button" onClick={()=>{setIt("");setDe("");setNotes("");}}>Zurücksetzen</button>
          </div>
        </form>);
      }

      function ListView({ items, setItems }) {
        const { useState, useMemo } = React;
        const [q,setQ] = useState("");
        const filtered = useMemo(()=>items.filter(i=>(norm(i.it).includes(norm(q)) || norm(i.de).includes(norm(q)))), [q,items]);
        function del(id) { if (confirm("Eintrag löschen?")) setItems(prev=>prev.filter(i=>i.id!==id)); }
        function toggle(id) { setItems(prev=>prev.map(i=>i.id===id ? {...i, suspended: !i.suspended} : i)); }
        return (<div className="card">
          <div className="grid">
            <input className="input" placeholder="Suchen…" value={q} onChange={e=>setQ(e.target.value)}/>
            <div className="muted">{filtered.length} / {items.length} Treffer</div>
          </div>
          <div style={{overflowX:'auto', marginTop:8}}>
            <table>
              <thead><tr><th>Italienisch</th><th>Deutsch</th><th>Fällig</th><th>Streak</th><th>Aktionen</th></tr></thead>
              <tbody>
                {filtered.map(i => (
                  <tr key={i.id}>
                    <td><b>{i.it}</b></td>
                    <td>{i.de}</td>
                    <td className="muted">{i.dueAt ? DATE_FMT.format(i.dueAt) : "–"}</td>
                    <td>{i.streak ?? 0}</td>
                    <td>
                      <button className="speaker-icon" onClick={()=>toggle(i.id)}>{i.suspended ? "Reaktivieren" : "Pausieren"}</button>
                      <button className="speaker-icon" onClick={()=>del(i.id)}>Löschen</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>);
      }

      function SettingsView({ items, setItems, settings, setSettings }) {
        const { useState } = React;
        const [importText,setImportText]=useState("");
        function exportData() { const blob = new Blob([JSON.stringify({items,settings}, null, 2)], {type:"application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='vokabeln.json'; a.click(); URL.revokeObjectURL(url); }
        function importData() { try { const p = JSON.parse(importText); if (!Array.isArray(p.items)) throw new Error("Ungültiges Format"); setItems(p.items); if (p.settings) setSettings(p.settings); alert("Import ok."); } catch(e) { alert("Import fehlgeschlagen: " + (e.message||e)); } }
        return (<div className="grid">
          <div className="card">
            <h3>Einstellungen</h3>
            <div className="grid grid-2">
              <label>Neue Karten pro Sitzung<input type="number" className="input" value={settings.newPerSession} onChange={e=>setSettings({...settings,newPerSession:Number(e.target.value)})}/></label>
              <label>Max. Wiederholungen pro Sitzung<input type="number" className="input" value={settings.maxReviews} onChange={e=>setSettings({...settings,maxReviews:Number(e.target.value)})}/></label>
            </div>
          </div>
          <div className="card">
            <h3>Daten</h3>
            <div style={{display:'flex', gap:8, flexWrap:'wrap'}}>
              <button className="speaker-icon" onClick={exportData}>Export als JSON</button>
              <button className="speaker-icon" onClick={()=>{ if (confirm('Alle Daten löschen?')) setItems([]) }}>Alles löschen</button>
            </div>
            <div style={{marginTop:10}}>
              <label>JSON importieren</label>
              <textarea className="input" rows="6" value={importText} onChange={e=>setImportText(e.target.value)} placeholder='{"items":[{"it":"ciao","de":"hallo"}], "settings":{}}'></textarea>
              <button className="btn primary" onClick={importData}>Import starten</button>
            </div>
          </div>
        </div>);
      }

      function defaultSettings() { return { newPerSession: 10, maxReviews: 100 }; }
      function demoSeed() { const t = now(); const m = (it,de,notes)=>({id:uid(),it,de,notes,createdAt:t,dueAt:t,intervalIndex:0,streak:0,suspended:false}); return [ m("ciao","hallo; tschüss","begrüssung"), m("grazie","danke"), m("per favore","bitte"), m("come stai?","wie geht's?"), m("acqua","Wasser"), m("pane","Brot"), m("vino","Wein") ]; }

      function App() {
        const [tab,setTab] = useState("learn");
        const [items,setItems] = useState(() => loadState()?.items || demoSeed());
        const [settings,setSettings] = useState(() => loadState()?.settings || defaultSettings());
        useEffect(()=>saveState({items,settings}),[items,settings]);
        return (<div className="grid">
          <Tabs tab={tab} setTab={setTab}/>
          {tab==='learn' && <LearnView items={items} setItems={setItems}/>}
          {tab==='list' && <ListView items={items} setItems={setItems}/>}
          {tab==='add' && <AddView onAdd={(i)=>setItems(p=>[i,...p])}/>}
          {tab==='settings' && <SettingsView items={items} setItems={setItems} settings={settings} setSettings={setSettings}/>}
          <div className="muted">Speicherung lokal im Browser. Für Backups: Einstellungen → Export.</div>
        </div>);
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
      if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('service-worker.js').catch(()=>{})); }
      function formatInterval(ms) { if (ms < 3600000) return Math.round(ms/60000)+' min'; if (ms < 86400000) return Math.round(ms/3600000)+' h'; return Math.round(ms/86400000)+' d'; }
    </script>
  </body>
</html>
